# MCP 學習課程 - 詳細練習設計

## 練習 1: Hello World MCP Server & Client
**難度**: ⭐  
**預估時間**: 2-3 小時

### 學習目標
- 建立最基本的 MCP Server 和 Client
- 理解 stdio transport 的工作原理
- 掌握 MCP 連接握手流程

### 技術要點
- McpServer 初始化
- StdioServerTransport 使用
- Client 初始化和連接
- 基本通訊協議

### 實作要求
```typescript
// Server 功能
- 建立名為 "hello-server" 的 MCP 服務器
- 實作一個 "echo" 工具，將輸入文字原樣返回
- 支援 stdio transport

// Client 功能  
- 建立連接到 server 的 client
- 調用 echo 工具並顯示結果
```

### 測試項目
```bash
npm test:01
```
- [ ] Server 成功啟動
- [ ] Client 成功連接
- [ ] Echo 工具正常運作
- [ ] 連接可正常關閉

### 提示文檔要點
- MCP 協議基礎概念
- stdio transport 的選擇理由
- 常見連接問題排除

---

## 練習 2: 靜態資源服務器
**難度**: ⭐⭐  
**預估時間**: 3-4 小時

### 學習目標
- 實作 MCP Resources 功能
- 理解 Resource 和 Tool 的差異
- 掌握靜態數據暴露方法

### 技術要點
- registerResource 方法
- 資源 URI 設計
- MIME 類型處理
- 資源元數據管理

### 實作要求
```typescript
// 保留練習1的所有功能，並新增：
- 註冊靜態資源 "config://app" - 應用配置信息
- 註冊靜態資源 "help://commands" - 命令說明文檔
- 註冊靜態資源 "status://server" - 服務器狀態信息
- Client 能夠列出和讀取所有資源
```

### 測試項目
```bash
npm test:02
```
- [ ] 練習1的所有測試通過
- [ ] 資源列表正確返回 3 個資源
- [ ] 每個資源都能正常讀取
- [ ] 資源內容格式正確
- [ ] MIME 類型設置正確

### 提示文檔要點
- Resource 與 Tool 的使用場景
- URI 命名最佳實踐
- 資源內容格式設計

---

## 練習 3: 基礎工具服務器
**難度**: ⭐⭐  
**預估時間**: 4-5 小時

### 學習目標
- 實作多種 MCP Tools
- 掌握參數驗證和錯誤處理
- 理解工具的副作用概念

### 技術要點
- registerTool 進階用法
- Zod schema 驗證
- 錯誤處理最佳實踐
- 工具元數據設計

### 實作要求
```typescript
// 保留練習1+2的所有功能，並新增：
- "calculate" 工具 - 基本數學運算 (加減乘除)
- "text-transform" 工具 - 文字轉換 (大小寫、反轉等)
- "timestamp" 工具 - 時間戳生成和格式化
- 所有工具都要有完整的參數驗證
```

### 測試項目
```bash
npm test:03
```
- [ ] 練習1+2的所有測試通過
- [ ] 工具列表正確返回 4 個工具
- [ ] calculate 工具支援四則運算
- [ ] text-transform 支援多種轉換
- [ ] timestamp 工具格式化正確
- [ ] 參數驗證錯誤正確處理
- [ ] 無效操作返回適當錯誤

### 提示文檔要點
- 工具設計原則
- 參數驗證策略
- 錯誤信息設計規範

---

## 練習 4: 動態資源系統
**難度**: ⭐⭐⭐  
**預估時間**: 5-6 小時

### 學習目標  
- 實作動態參數化資源
- 掌握 ResourceTemplate 使用
- 理解 URI 模板解析

### 技術要點
- ResourceTemplate 進階用法
- 參數提取和驗證
- 動態內容生成
- 資源依賴關係

### 實作要求
```typescript
// 保留前3個練習的所有功能，並新增：
- "user://{userId}/profile" - 用戶資料資源
- "file://{category}/{filename}" - 文件系統資源  
- "data://{type}/latest" - 最新數據資源
- 支援資源參數自動完成
```

### 測試項目
```bash
npm test:04
```
- [ ] 前3個練習的所有測試通過
- [ ] 動態資源正確解析參數
- [ ] 不同參數組合返回不同內容
- [ ] 無效參數正確處理
- [ ] 資源模板列表功能正常
- [ ] 參數自動完成提示正確

### 提示文檔要點
- URI 模板設計模式
- 參數驗證策略
- 動態內容快取考量

---

## 練習 5: 進階工具與錯誤處理
**難度**: ⭐⭐⭐  
**預估時間**: 6-7 小時

### 學習目標
- 實作複雜異步工具
- 掌握完整錯誤處理機制  
- 理解工具執行生命週期

### 技術要點
- 異步工具實作
- 錯誤分類和處理
- 工具執行狀態管理
- 資源和工具的協同

### 實作要求
```typescript
// 保留前4個練習的所有功能，並新增：
- "file-read" 工具 - 讀取本地文件 (異步)
- "file-write" 工具 - 寫入本地文件 (異步)
- "http-fetch" 工具 - HTTP 請求 (異步，模擬)
- "data-process" 工具 - 數據處理 (可能失敗)
- 完整的錯誤分類和處理
```

### 測試項目
```bash
npm test:05
```
- [ ] 前4個練習的所有測試通過
- [ ] 異步工具正確執行
- [ ] 文件操作工具正常工作
- [ ] HTTP 工具模擬請求成功
- [ ] 各種錯誤情況正確處理
- [ ] 錯誤信息分類清晰
- [ ] 工具超時處理正確

### 提示文檔要點  
- 異步工具設計模式
- 錯誤處理最佳實踐
- 工具安全性考量

---

## 練習 6: 提示模板系統
**難度**: ⭐⭐⭐  
**預估時間**: 5-6 小時

### 學習目標
- 實作 MCP Prompts 功能
- 掌握提示模板設計
- 理解參數化提示使用

### 技術要點
- registerPrompt 方法
- 提示參數設計
- 消息格式標準化
- 提示模板重用

### 實作要求
```typescript
// 保留前5個練習的所有功能，並新增：
- "code-review" 提示 - 代碼審查模板
- "documentation" 提示 - 文檔生成模板  
- "bug-report" 提示 - 錯誤報告模板
- "meeting-summary" 提示 - 會議總結模板
- 支援提示參數自動完成
```

### 測試項目
```bash
npm test:06
```
- [ ] 前5個練習的所有測試通過
- [ ] 提示列表正確返回 4 個提示
- [ ] 每個提示參數正確填充
- [ ] 消息格式符合 MCP 標準
- [ ] 提示參數驗證正確
- [ ] 參數自動完成功能正常

### 提示文檔要點
- 提示模板設計原則
- 參數化策略
- 消息格式最佳實踐

---

## 練習 7: 整合功能服務器
**難度**: ⭐⭐⭐⭐  
**預估時間**: 7-8 小時

### 學習目標
- 整合 Resources、Tools、Prompts
- 實作功能間協同操作
- 掌握複雜數據流處理

### 技術要點
- 跨功能整合設計
- 數據流管理
- 狀態同步機制
- 功能依賴關係

### 實作要求
```typescript
// 保留前6個練習的所有功能，並新增整合功能：
- 內容管理系統模擬
  - 資源: "content://{type}/{id}"
  - 工具: "content-create", "content-update", "content-delete"  
  - 提示: "content-generation", "content-optimization"
- 功能間數據流協同
- 統一的內容存儲和檢索
```

### 測試項目
```bash
npm test:07
```
- [ ] 前6個練習的所有測試通過
- [ ] 內容 CRUD 操作正確
- [ ] 資源和工具數據一致性
- [ ] 提示生成內容可通過工具創建
- [ ] 整合工作流端到端測試通過
- [ ] 併發操作處理正確

### 提示文檔要點
- 整合架構設計
- 數據一致性保證
- 併發處理策略

---

## 練習 8: HTTP 傳輸服務器
**難度**: ⭐⭐⭐⭐  
**預估時間**: 8-9 小時

### 學習目標
- 實作 Streamable HTTP transport
- 掌握會話管理機制
- 理解遠端 MCP 服務部署

### 技術要點
- Express.js 整合
- StreamableHTTPServerTransport
- 會話生命週期管理
- HTTP 錯誤處理

### 實作要求
```typescript
// 保留前7個練習的所有功能，並新增：
- HTTP 服務器支援 (Express.js)
- 會話管理功能
- 同時支援 stdio 和 HTTP transport
- HTTP Client 實作
- 遠端調用測試
```

### 測試項目
```bash
npm test:08
```
- [ ] 前7個練習的所有測試通過 (stdio)
- [ ] HTTP 服務器成功啟動
- [ ] HTTP Client 成功連接
- [ ] 會話管理正確工作
- [ ] 所有功能通過 HTTP 正常運作
- [ ] 併發 HTTP 連接處理正確
- [ ] HTTP 錯誤處理適當

### 提示文檔要點
- HTTP transport 選擇考量
- 會話管理最佳實踐
- 網路錯誤處理策略

---

## 練習 9: 動態服務器功能
**難度**: ⭐⭐⭐⭐⭐  
**預估時間**: 9-10 小時

### 學習目標
- 實作運行時動態功能管理
- 掌握 MCP 通知機制
- 理解插件化架構設計

### 技術要點
- 動態註冊/移除功能
- listChanged 通知機制
- 插件加載和卸載
- 權限和狀態管理

### 實作要求
```typescript
// 保留前8個練習的所有功能，並新增：
- 動態插件系統
  - 運行時載入新工具
  - 運行時添加新資源
  - 權限控制功能開關
- "plugin-manager" 工具 - 插件管理
- "permission-control" 工具 - 權限管理
- 自動通知機制
```

### 測試項目
```bash
npm test:09
```
- [ ] 前8個練習的所有測試通過
- [ ] 動態添加工具功能正常
- [ ] 動態移除工具功能正常
- [ ] listChanged 通知正確發送
- [ ] 權限控制正確工作
- [ ] 插件系統載入/卸載穩定
- [ ] 多客戶端通知同步正確

### 提示文檔要點
- 動態功能設計模式
- 通知機制實作
- 插件安全性考量

---

## 練習 10: 持久化MCP應用 - 簡易內容管理器
**難度**: ⭐⭐⭐⭐  
**預估時間**: 8-10 小時

### 學習目標
- **核心目標**: 將前9個練習的所有知識整合成一個完整的MVP
- 掌握MCP與SQLite數據庫的整合模式
- 理解MCP Resources和Tools如何映射到數據庫操作
- 學會設計持久化的MCP應用架構

### 技術要點
- SQLite數據庫設計與初始化
- MCP Resources與數據庫查詢的映射
- MCP Tools與數據庫CRUD操作的整合
- 數據持久化與狀態管理

### 實作要求
```typescript
// 在前9個練習基礎上，新增數據庫持久化功能：

// 數據庫設計 (SQLite)
- articles 表: id, title, content, author, status, created_at, updated_at
- tags 表: id, name
- article_tags 表: article_id, tag_id

// MCP資源映射
- "content://articles" - 列出所有文章
- "content://articles/{id}" - 讀取特定文章
- "content://tags" - 列出所有標籤

// MCP工具映射  
- "article-create" - INSERT新文章到數據庫
- "article-update" - UPDATE現有文章
- "article-delete" - DELETE文章
- "article-list" - SELECT文章列表(支援過濾)
- "tag-manage" - 標籤CRUD操作

// MCP提示整合
- "article-template" - 使用提示生成文章內容，然後保存到數據庫
```

### 測試項目
```bash
npm test:10
```
- [ ] 前9個練習的所有測試通過
- [ ] SQLite數據庫正確初始化
- [ ] MCP資源正確讀取數據庫數據
- [ ] MCP工具正確執行CRUD操作
- [ ] 文章創建-讀取-更新-刪除流程完整
- [ ] 標籤系統與文章關聯正確
- [ ] 提示生成的內容可以保存到數據庫
- [ ] 數據持久化在服務器重啟後保持
- [ ] 所有數據庫操作有適當的錯誤處理

### 提示文檔要點
- MCP與關聯式數據庫的整合策略
- 數據庫設計對MCP資源結構的影響
- 從內存存儲遷移到持久化存儲的最佳實踐

---

## 練習 11: 服務間通信 - 代碼分析工具整合
**難度**: ⭐⭐⭐⭐⭐  
**預估時間**: 10-12 小時

### 學習目標
- **核心目標**: 學習如何讓兩個MCP服務互相通信和協作
- 掌握MCP服務發現和API調用模式
- 理解分布式MCP應用的基本架構
- 學會設計跨服務的數據流

### 技術要點
- MCP Client在服務器端的使用
- 跨服務MCP工具調用
- 服務間數據傳遞和同步
- 簡單的服務發現機制

### 實作要求
```typescript
// 基於練習10的內容管理器，創建一個獨立的代碼分析服務：

// 代碼分析服務 (新的MCP服務器)
- "analysis://file/{filename}" - 讀取要分析的代碼文件
- "results://analysis/{id}" - 讀取分析結果

// 分析工具
- "analyze-file" - 分析單個代碼文件(簡單的行數、函數計數等)
- "generate-report" - 將分析結果轉換為報告格式

// 服務整合邏輯
- 代碼分析服務完成分析後，自動調用練習10的CMS
- 使用CMS的"article-create"工具，將分析報告保存為文章
- 分析結果可以通過CMS的資源系統被其他服務讀取

// 具體流程
1. 用戶調用代碼分析服務的"analyze-file"工具
2. 分析服務處理文件，生成報告
3. 分析服務作為客戶端，連接到CMS服務
4. 分析服務調用CMS的"article-create"，保存報告
5. 用戶可以通過CMS的"content://articles"資源讀取報告
```

### 測試項目
```bash
npm test:11
```
- [ ] 練習10的CMS服務正常運行
- [ ] 代碼分析服務獨立啟動成功
- [ ] 分析服務可以讀取和分析代碼文件
- [ ] 分析服務可以連接到CMS服務
- [ ] 跨服務MCP工具調用成功
- [ ] 分析報告正確保存到CMS數據庫
- [ ] 可以通過CMS資源讀取分析結果
- [ ] 服務間錯誤處理適當
- [ ] 兩個服務可以同時運行而不衝突

### 提示文檔要點
- MCP服務間通信的基本模式
- 如何在MCP服務器中使用MCP客戶端
- 分布式MCP應用的設計考量

---

## 整體測試策略

### 自動化測試命令
```bash
# 運行單個練習測試
npm run test:01
npm run test:02
...
npm run test:11

# 運行累積測試 (包含前面所有練習)
npm run test:cumulative:05
npm run test:cumulative:10

# 運行完整測試套件
npm run test:all

# 性能測試  
npm run test:performance

# 整合測試
npm run test:integration
```

### 測試覆蓋率要求
- 單元測試覆蓋率 > 90%
- 整合測試覆蓋率 > 80%
- 端到端測試覆蓋主要工作流

## 課程總結

本MCP課程從基礎到專家級，系統性地涵蓋了：

### 🔰 基礎層 (練習1-3)
- **MCP協議核心概念**：Echo、Resources、Tools
- **JSON-RPC基礎**：請求/響應機制
- **基本工具開發**：輸入驗證、錯誤處理

### 🚀 進階層 (練習4-7) 
- **動態MCP功能**：參數化資源、複雜工具
- **協議整合特性**：提示模板、跨功能協同
- **狀態管理**：數據持久化、工作流管理

### 🌐 企業層 (練習8-9)
- **傳輸協議精通**：HTTP傳輸、會話管理
- **高級MCP特性**：動態插件、自動通知機制
- **多客戶端管理**：權限控制、狀態同步

### 🏢 整合層 (練習10-11)
- **應用整合**：將所有MCP組件整合成完整MVP
- **數據持久化**：MCP與數據庫的深度整合
- **服務間通信**：分布式MCP應用架構
- **實際應用場景**：內容管理與代碼分析的實用案例

### 🎯 學習成果
完成全部練習後，學員將具備：
- **MCP協議全面掌握**：從基礎概念到高級應用
- **完整應用開發能力**：能夠設計和實現端到端的MCP解決方案
- **數據持久化整合技能**：掌握MCP與數據庫的整合模式
- **分布式系統基礎**：理解MCP服務間通信和協作
- **實際問題解決能力**：能夠將MCP應用到真實業務場景中