# ç·´ç¿’ 10 æ¸¬è©¦å¥—ä»¶èªªæ˜

## æ¸¬è©¦æ¦‚è¿°

æœ¬æ¸¬è©¦å¥—ä»¶å…¨é¢é©—è­‰ç·´ç¿’10ï¼ˆæŒä¹…åŒ–MCPæ‡‰ç”¨ - ç°¡æ˜“å…§å®¹ç®¡ç†å™¨ï¼‰çš„å¯¦ä½œæ­£ç¢ºæ€§ï¼ŒåŒ…æ‹¬è³‡æ–™åº«å±¤å’ŒMCPå”è­°å±¤çš„å®Œæ•´æ¸¬è©¦ã€‚

## ğŸ§ª æ¸¬è©¦çµæ§‹

### 1. è³‡æ–™åº«å±¤æ¸¬è©¦ (`database.test.ts`)
å°ˆé–€æ¸¬è©¦è³‡æ–™åº«æ“ä½œé‚è¼¯ï¼Œä¸ä¾è³´MCPå”è­°ï¼š

#### æ¸¬è©¦ç¯„åœ
- **è³‡æ–™åº«åˆå§‹åŒ–**: è¡¨å‰µå»ºã€ç´¢å¼•ã€è¦–åœ–ã€è§¸ç™¼å™¨
- **æ–‡ç« CRUDæ“ä½œ**: å‰µå»ºã€è®€å–ã€æ›´æ–°ã€åˆªé™¤æ–‡ç« 
- **æ¨™ç±¤ç®¡ç†**: æ¨™ç±¤å‰µå»ºã€é—œè¯ã€æŸ¥è©¢
- **æ•¸æ“šé©—è­‰**: è¼¸å…¥é©—è­‰ã€ç´„æŸæª¢æŸ¥
- **éŒ¯èª¤è™•ç†**: SQLiteéŒ¯èª¤åˆ†é¡å’Œè™•ç†
- **æ•¸æ“šå®Œæ•´æ€§**: æ™‚é–“æˆ³ã€Unicodeã€ç‰¹æ®Šå­—ç¬¦

#### é—œéµæ¸¬è©¦æ¡ˆä¾‹
```typescript
// æ–‡ç« å‰µå»ºé©—è­‰
test('æ‡‰è©²æˆåŠŸå‰µå»ºæ–‡ç« ', async () => {
  const article = {
    title: 'æ¸¬è©¦æ–‡ç« ',
    content: 'é€™æ˜¯æ¸¬è©¦å…§å®¹',
    author: 'æ¸¬è©¦ä½œè€…',
    status: 'draft' as const
  };
  const id = await createArticle(article);
  expect(typeof id).toBe('number');
});

// æ•¸æ“šé©—è­‰
test('æ‡‰è©²æ‹’çµ•ç©ºæ¨™é¡Œ', async () => {
  const article = { title: '', content: 'å…§å®¹', author: 'ä½œè€…', status: 'draft' as const };
  await expect(createArticle(article)).rejects.toThrow(DatabaseError);
});

// é—œè¯é—œä¿‚
test('æ‡‰è©²èƒ½ç‚ºæ–‡ç« åˆ†é…æ¨™ç±¤', async () => {
  const success = await assignTagToArticle(articleId, tagId);
  expect(success).toBe(true);
});
```

### 2. æ•´åˆæ¸¬è©¦ (`integration.test.ts`)
æ¸¬è©¦å®Œæ•´çš„MCPæœå‹™å™¨ï¼Œé©—è­‰ç«¯åˆ°ç«¯åŠŸèƒ½ï¼š

#### æ¸¬è©¦ç¯„åœ
- **MCPå”è­°**: åˆå§‹åŒ–ã€capabilityå”å•†
- **Resources**: éœæ…‹å’Œå‹•æ…‹è³‡æºè®€å–
- **Tools**: æ‰€æœ‰å·¥å…·çš„èª¿ç”¨å’Œåƒæ•¸é©—è­‰
- **Prompts**: æç¤ºç”Ÿæˆå’Œåƒæ•¸è™•ç†
- **å·¥ä½œæµ**: ç«¯åˆ°ç«¯æ¥­å‹™æµç¨‹
- **éŒ¯èª¤è™•ç†**: å”è­°ç´šéŒ¯èª¤è™•ç†
- **ä½µç™¼è™•ç†**: å¤šè«‹æ±‚ä¸¦ç™¼æ¸¬è©¦

#### é—œéµæ¸¬è©¦æ¡ˆä¾‹
```typescript
// MCPå”è­°åˆå§‹åŒ–
test('æ‡‰è©²æˆåŠŸåˆå§‹åŒ–MCPå”è­°', async () => {
  await client.initialize();
  expect(true).toBe(true);
});

// è³‡æºè®€å–
test('æ‡‰è©²è®€å–æ–‡ç« åˆ—è¡¨è³‡æº', async () => {
  const response = await client.sendRequest('resources/read', {
    uri: 'content://articles'
  });
  expect(response.error).toBeUndefined();
  const articles = JSON.parse(response.result.contents[0].text);
  expect(Array.isArray(articles)).toBe(true);
});

// å·¥å…·èª¿ç”¨
test('æ‡‰è©²å‰µå»ºæ–‡ç« ', async () => {
  const response = await client.sendRequest('tools/call', {
    name: 'article-create',
    arguments: { title: 'æ–°æ–‡ç« ', content: 'æ–°æ–‡ç« çš„å…§å®¹', author: 'ä½œè€…å', status: 'draft' }
  });
  expect(response.error).toBeUndefined();
  expect(response.result.content[0].text).toContain('æ–‡ç« å‰µå»ºæˆåŠŸ');
});
```

## ğŸš€ é‹è¡Œæ¸¬è©¦

### ç’°å¢ƒæº–å‚™
```bash
# ç¢ºä¿å·²å®‰è£ä¾è³´
npm install

# ç·¨è­¯TypeScriptï¼ˆæ•´åˆæ¸¬è©¦éœ€è¦ï¼‰
npm run build
```

### é‹è¡Œå–®å€‹æ¸¬è©¦å¥—ä»¶
```bash
# è³‡æ–™åº«å±¤æ¸¬è©¦
npm run test -- database.test.ts

# æ•´åˆæ¸¬è©¦  
npm run test -- integration.test.ts

# é‹è¡Œæ‰€æœ‰ç·´ç¿’10çš„æ¸¬è©¦
npm run test:10
```

### é‹è¡Œç‰¹å®šæ¸¬è©¦
```bash
# é‹è¡Œç‰¹å®šæ¸¬è©¦æ¡ˆä¾‹
npm run test -- --testNamePattern="æ‡‰è©²æˆåŠŸå‰µå»ºæ–‡ç« "

# é‹è¡Œç‰¹å®šæ¸¬è©¦çµ„
npm run test -- --testNamePattern="æ–‡ç« CRUDæ“ä½œ"
```

### é™¤éŒ¯æ¨¡å¼
```bash
# å•Ÿç”¨è©³ç´°è¼¸å‡º
npm run test -- --verbose

# ç›£è¦–æ¨¡å¼
npm run test -- --watch

# è¦†è“‹ç‡å ±å‘Š
npm run test:coverage
```

## ğŸ”§ æ¸¬è©¦é…ç½®

### Jest é…ç½®é‡é»
```json
{
  "testEnvironment": "node",
  "testTimeout": 30000,
  "setupFilesAfterEnv": ["<rootDir>/tests/setup.ts"],
  "testMatch": ["**/*.test.ts"],
  "transform": {
    "^.+\\.ts$": "ts-jest"
  }
}
```

### æ¸¬è©¦è³‡æ–™åº«
- ä½¿ç”¨ç¨ç«‹çš„æ¸¬è©¦è³‡æ–™åº« `test_content.db`
- æ¯å€‹æ¸¬è©¦å‰è‡ªå‹•æ¸…ç†å’Œé‡å»º
- èˆ‡é–‹ç™¼è³‡æ–™åº«å®Œå…¨éš”é›¢

### è¶…æ™‚è¨­ç½®
- æ•´åˆæ¸¬è©¦ï¼š30ç§’ï¼ˆåŒ…å«æœå‹™å™¨å•Ÿå‹•æ™‚é–“ï¼‰
- è³‡æ–™åº«æ¸¬è©¦ï¼š10ç§’
- å–®å€‹è«‹æ±‚ï¼š5ç§’

## ğŸ“Š æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™

### æœ€ä½è¦æ±‚
- **èªå¥è¦†è“‹ç‡**: > 90%
- **åˆ†æ”¯è¦†è“‹ç‡**: > 85%
- **å‡½æ•¸è¦†è“‹ç‡**: > 95%
- **è¡Œè¦†è“‹ç‡**: > 90%

### é‡é»è¦†è“‹ç¯„åœ
- æ‰€æœ‰CRUDæ“ä½œ
- éŒ¯èª¤è™•ç†è·¯å¾‘
- é‚Šç•Œæ¢ä»¶
- ä½µç™¼å ´æ™¯
- MCPå”è­°äº¤äº’

## ğŸ› å¸¸è¦‹æ¸¬è©¦å•é¡Œ

### 1. æœå‹™å™¨å•Ÿå‹•è¶…æ™‚
**ç—‡ç‹€**: æ•´åˆæ¸¬è©¦ä¸­æœå‹™å™¨å•Ÿå‹•å¤±æ•—
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥ç·¨è­¯ç‹€æ…‹
npm run build

# æª¢æŸ¥ä¾è³´
npm install sqlite3

# æ‰‹å‹•æ¸¬è©¦æœå‹™å™¨
node dist/solutions/10-content-management/server.js
```

### 2. è³‡æ–™åº«é–å®šéŒ¯èª¤
**ç—‡ç‹€**: `database is locked` éŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ¸…ç†æ¸¬è©¦è³‡æ–™åº«
rm -f data/test_*.db

# ç¢ºä¿æ²’æœ‰æ®˜ç•™é€²ç¨‹
pkill -f "content-management"
```

### 3. TypeScript ç·¨è­¯éŒ¯èª¤
**ç—‡ç‹€**: æ¸¬è©¦ä¸­çš„importéŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥tsconfig.json
# ç¢ºä¿æ¨¡çµ„è§£æè¨­ç½®æ­£ç¢º
# é‡æ–°ç·¨è­¯
npm run build
```

### 4. ä½µç™¼æ¸¬è©¦å¤±æ•—
**ç—‡ç‹€**: å¤šå€‹ä¸¦ç™¼è«‹æ±‚å¤±æ•—
**è§£æ±ºæ–¹æ¡ˆ**:
- å¢åŠ æ¸¬è©¦è¶…æ™‚æ™‚é–“
- æª¢æŸ¥SQLiteé€£æ¥ç®¡ç†
- é©—è­‰è³‡æºæ¸…ç†é‚è¼¯

## ğŸ“‹ æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### åœ¨æäº¤å‰ç¢ºä¿
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] è¦†è“‹ç‡é”åˆ°ç›®æ¨™
- [ ] æ²’æœ‰æ¸¬è©¦è·³é
- [ ] æ¸…ç†æ‰€æœ‰æ¸¬è©¦è³‡æ–™
- [ ] æª¢æŸ¥æ¸¬è©¦è¼¸å‡ºç„¡è­¦å‘Š

### æ¸¬è©¦å“è³ªæª¢æŸ¥
- [ ] æ¸¬è©¦åç¨±æ¸…æ™°æè¿°é æœŸè¡Œç‚º
- [ ] ä½¿ç”¨é©ç•¶çš„assertion
- [ ] æ¸¬è©¦æ•¸æ“šå…·æœ‰ä»£è¡¨æ€§
- [ ] é‚Šç•Œæ¢ä»¶è¢«è¦†è“‹
- [ ] éŒ¯èª¤æƒ…æ³è¢«æ¸¬è©¦

## ğŸ¯ æ¸¬è©¦ç­–ç•¥

### 1. åˆ†å±¤æ¸¬è©¦
- **å–®å…ƒæ¸¬è©¦**: è³‡æ–™åº«å‡½æ•¸ç¨ç«‹æ¸¬è©¦
- **æ•´åˆæ¸¬è©¦**: MCPå”è­°ç«¯åˆ°ç«¯æ¸¬è©¦
- **å·¥ä½œæµæ¸¬è©¦**: æ¥­å‹™æµç¨‹å®Œæ•´é©—è­‰

### 2. æ•¸æ“šé©…å‹•æ¸¬è©¦
```typescript
// ä½¿ç”¨æ¸¬è©¦æ•¸æ“šé›†
const testArticles = [
  { title: 'çŸ­æ¨™é¡Œ', content: 'çŸ­å…§å®¹', author: 'ä½œè€…1' },
  { title: 'åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ¨™é¡Œï¼@#$', content: 'å¤šè¡Œ\nå…§å®¹', author: 'ä½œè€…2' },
  { title: 'è¶…é•·æ¨™é¡Œ'.repeat(10), content: 'è¶…é•·å…§å®¹'.repeat(100), author: 'ä½œè€…3' }
];

testArticles.forEach((articleData, index) => {
  test(`æ‡‰è©²è™•ç†æ¸¬è©¦æ•¸æ“š ${index + 1}`, async () => {
    // æ¸¬è©¦é‚è¼¯
  });
});
```

### 3. å¿«ç…§æ¸¬è©¦
```typescript
// å°æ–¼è¤‡é›œçš„éŸ¿æ‡‰æ ¼å¼
expect(response.result).toMatchSnapshot();
```

## ğŸ” é™¤éŒ¯æŒ‡å—

### å•Ÿç”¨é™¤éŒ¯æ—¥èªŒ
```typescript
// åœ¨æ¸¬è©¦ä¸­å•Ÿç”¨é™¤éŒ¯
process.env.DEBUG = 'mcp:*';
process.env.NODE_ENV = 'test';
```

### æª¢æŸ¥æ¸¬è©¦è³‡æ–™åº«
```bash
# ä¿ç•™æ¸¬è©¦è³‡æ–™åº«é€²è¡Œæª¢æŸ¥
sqlite3 data/test_content.db
.tables
.schema
SELECT * FROM articles;
```

### åˆ†æå¤±æ•—çš„æ¸¬è©¦
```bash
# é‹è¡Œå–®å€‹å¤±æ•—çš„æ¸¬è©¦
npm run test -- --testNamePattern="å¤±æ•—çš„æ¸¬è©¦åç¨±" --verbose

# ç”Ÿæˆè©³ç´°å ±å‘Š
npm run test -- --reporters=default --reporters=jest-html-reporter
```

é€™å€‹æ¸¬è©¦å¥—ä»¶ç¢ºä¿ç·´ç¿’10çš„å¯¦ä½œå®Œå…¨ç¬¦åˆè¦æ±‚ï¼Œç‚ºå­¸ç¿’è€…æä¾›å¯é çš„é©—è­‰æ©Ÿåˆ¶ï¼ŒåŒæ™‚å±•ç¤ºäº†MCPæ‡‰ç”¨çš„æ¸¬è©¦æœ€ä½³å¯¦è¸ã€‚